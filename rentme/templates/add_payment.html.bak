{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h2>Record Payment for {{ tenant.name }}</h2>

  <form method="post" id="add-payment-form" action="{{ url_for('payment_add') }}">
    <div class="mb-3">
      <label class="form-label">Amount (Ksh)</label>
      <input type="number" step="0.01" name="amount" class="form-control" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Notes (optional)</label>
      <textarea name="note" class="form-control"></textarea>
    </div>

    <!-- ðŸ” Hidden field that JS will fill with password from popup -->
    <input type="hidden" name="password_confirm" id="password_confirm">

    <button class="btn btn-primary" type="submit" id="save-payment-btn">
      Save Payment
    </button>
  </form>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("add-payment-form");
      const saveBtn = document.getElementById("save-payment-btn");
      const passwordField = document.getElementById("password_confirm");

      if (form && saveBtn && passwordField) {
        saveBtn.addEventListener("click", function (event) {
          // stop normal submit
          event.preventDefault();

          const password = prompt("Please confirm your account password to add this payment:");

          if (!password) {
            alert("Payment cancelled. Password is required to proceed.");
            return;
          }

          passwordField.value = password;
          form.submit();
        });
      } else {
        console.log("DEBUG: form or button or password field not found");
      }
    });
  </script>
{% endblock %}
